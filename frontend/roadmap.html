<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arithmo - Your Math Journey</title>
    <link rel="icon" type="image/png" href="assets/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="assets/favicon/favicon.svg" />
    <link rel="shortcut icon" href="assets/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Arithmo" />
    <link rel="manifest" href="assets/favicon/site.webmanifest" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://kit.fontawesome.com/d59a7ad26f.js" crossorigin="anonymous"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet" />

    <!-- Balls Background CSS -->
    <link rel="stylesheet" href="assets/moving-balls-bg.css" />
    <link rel="stylesheet" href="assets/common_style.css" />
    <link rel="stylesheet" href="assets/style.css">

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ea2a33",
                        "primary-light": "#ff6b6b",
                        "primary-dark": "#b91c1c",
                        "secondary": "#4f46e5",
                        "background-light": "#f8f6f6",
                        "background-dark": "#211111",
                        "success": "#10b981",
                        "warning": "#f59e0b",
                        "gray-light": "#f3f4f6",
                        "gray-medium": "#9ca3af",
                        "gray-dark": "#4b5563"
                    },
                    fontFamily: {
                        "display": ["Lexend", "sans-serif"],
                        "brand": ["Bungee", "cursive"],
                    },
                    borderRadius: {
                        "DEFAULT": "1rem",
                        "lg": "2rem",
                        "xl": "3rem",
                        "full": "9999px"
                    },
                    boxShadow: {
                        'soft': '0 4px 20px rgba(0, 0, 0, 0.08)',
                        'medium': '0 8px 30px rgba(0, 0, 0, 0.12)',
                        'glow': '0 0 20px rgba(234, 42, 51, 0.3)',
                        'inner-lg': 'inset 0 2px 10px 0 rgba(0, 0, 0, 0.06)'
                    }
                },
            },
        }
    </script>
    <style>
        /* IMPROVED ROADMAP STYLES */
        .roadmap-wrapper {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Progress Header */
        .progress-header {
            background: linear-gradient(135deg, #fff 0%, #fef2f2 100%);
            border: 1px solid rgba(234, 42, 51, 0.1);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 3rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(234, 42, 51, 0.1);
        }

        /* Roadmap Container */
        .roadmap-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3rem;
            position: relative;
        }

        /* Roadmap Line */
        .roadmap-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #ea2a33, #4f46e5);
            transform: translateX(-50%);
            z-index: 1;
            border-radius: 2px;
        }

        /* Roadmap Item */
        .roadmap-item {
            display: flex;
            align-items: center;
            width: 100%;
            position: relative;
            z-index: 2;
            gap: 2rem;
        }

        .roadmap-item:nth-child(odd) {
            flex-direction: row-reverse;
        }

        .roadmap-item-content {
            flex: 1;
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(234, 42, 51, 0.1);
            transition: all 0.3s ease;
        }

        .roadmap-item:hover .roadmap-item-content {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(234, 42, 51, 0.15);
        }

        /* Level Node - IMPROVED */
        .level-node {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 3;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .level-node::after {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: 50%;
            border: 2px solid transparent;
            transition: all 0.4s ease;
        }

        /* STATES - IMPROVED */
        .level-node.completed {
            background: linear-gradient(135deg, #ea2a33, #ff6b6b);
            border-color: #ea2a33;
            color: white;
            box-shadow: 0 10px 30px rgba(234, 42, 51, 0.3);
        }

        .level-node.completed::after {
            border-color: rgba(234, 42, 51, 0.2);
        }

        .level-node.active {
            background: linear-gradient(135deg, #4f46e5, #8b5cf6);
            border-color: #4f46e5;
            color: white;
            box-shadow: 0 0 0 15px rgba(79, 70, 229, 0.2),
                0 15px 40px rgba(79, 70, 229, 0.4);
            animation: pulse-active 2s infinite;
        }

        .level-node.active::after {
            border-color: rgba(79, 70, 229, 0.3);
            animation: pulse-ring 2s infinite;
        }

        .level-node.locked {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border-color: #d1d5db;
            color: #9ca3af;
            cursor: not-allowed;
        }

        /* Level Name */
        .level-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .level-description {
            color: #6b7280;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 1rem;
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .status-active {
            background: rgba(79, 70, 229, 0.1);
            color: #4f46e5;
        }

        .status-locked {
            background: rgba(156, 163, 175, 0.1);
            color: #9ca3af;
        }

        /* MODAL - IMPROVED */
        .level-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease;
        }

        .level-modal.active {
            display: flex;
        }

        .modal-card {
            background: white;
            border-radius: 28px;
            padding: 3rem;
            width: 90%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(234, 42, 51, 0.1);
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.9;
        }

        /* Badge animations */
        @keyframes badge-pop {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .badge-earned {
            animation: badge-pop 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ANIMATIONS */
        @keyframes pulse-active {

            0%,
            100% {
                box-shadow: 0 0 0 15px rgba(79, 70, 229, 0.2),
                    0 15px 40px rgba(79, 70, 229, 0.4);
            }

            50% {
                box-shadow: 0 0 0 20px rgba(79, 70, 229, 0.1),
                    0 20px 50px rgba(79, 70, 229, 0.5);
            }
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(1);
                opacity: 0.5;
            }

            100% {
                transform: scale(1.3);
                opacity: 0;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Progress Display */
        .progress-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#ea2a33 var(--progress), #f3f4f6 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .progress-circle-inner {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .roadmap-item {
                flex-direction: column !important;
                text-align: center;
                gap: 1.5rem;
            }

            .roadmap-line {
                display: none;
            }

            .level-node {
                width: 80px;
                height: 80px;
                font-size: 1.5rem;
            }

            .progress-header {
                padding: 1.5rem;
            }
        }
    </style>
</head>

<body class="font-display moving-balls-bg bg-gray-50">

    <div class="flex flex-col min-h-screen w-full px-4 sm:px-6 lg:px-8 py-6">

        <!-- NAV BAR -->
        <div class="nav_container" id="nav_container_id">
            <!-- JAVA SCRIPT WILL AUTOMATICALLY ADD THE CONTENT OF NAVBAR HERE -->
        </div>

        <!-- MAIN CONTENT -->
        <main class="flex-1">
            <div class="roadmap-wrapper py-8">

                <!-- Progress Summary Card -->
                <div id="overall-progress-display" class="progress-header">
                    <div class="text-center mb-8">
                        <h1 class="font-brand text-4xl sm:text-5xl text-gray-900 mb-4">
                            üöÄ Your Math Journey
                        </h1>
                        <p class="text-lg text-gray-600 mb-8">
                            Master math one level at a time. Track your progress and earn rewards!
                        </p>

                        <!-- Overall Stats -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                            <div
                                class="bg-white p-6 rounded-2xl shadow-soft text-center border border-gray-100 hover:shadow-md transition-shadow">
                                <div class="text-3xl text-primary font-bold mb-2" id="levels-completed">0/5</div>
                                <div class="text-sm text-gray-500 font-medium">Levels Completed</div>
                            </div>
                            <div
                                class="bg-white p-6 rounded-2xl shadow-soft text-center border border-gray-100 hover:shadow-md transition-shadow">
                                <div class="text-3xl text-primary font-bold mb-2" id="total-activities">0/50</div>
                                <div class="text-sm text-gray-500 font-medium">Activities</div>
                            </div>
                            <div
                                class="bg-white p-6 rounded-2xl shadow-soft text-center border border-gray-100 hover:shadow-md transition-shadow">
                                <div class="text-3xl text-yellow-500 font-bold mb-2" id="total-stars">0</div>
                                <div class="text-sm text-gray-500 font-medium">‚≠ê Stars</div>
                            </div>
                            <div
                                class="bg-white p-6 rounded-2xl shadow-soft text-center border border-gray-100 hover:shadow-md transition-shadow">
                                <div class="text-3xl text-purple-500 font-bold mb-2" id="total-tokens">0</div>
                                <div class="text-sm text-gray-500 font-medium">üé® Tokens</div>
                            </div>
                        </div>

                        <!-- Badges Display -->
                        <div class="mt-8">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">üèÜ Your Badges</h3>
                            <div class="flex flex-wrap justify-center gap-4" id="badges-container">
                                <!-- Badges will be dynamically added here -->
                                <div
                                    class="bg-gradient-to-br from-amber-200 to-yellow-400 p-4 rounded-full shadow-md hover:scale-110 transition-transform duration-300 opacity-50">
                                    <i class="fas fa-trophy text-2xl text-gray-600"></i>
                                </div>
                                <div
                                    class="bg-gradient-to-br from-blue-200 to-cyan-400 p-4 rounded-full shadow-md hover:scale-110 transition-transform duration-300 opacity-50">
                                    <i class="fas fa-star text-2xl text-gray-600"></i>
                                </div>
                                <div
                                    class="bg-gradient-to-br from-red-200 to-pink-400 p-4 rounded-full shadow-md hover:scale-110 transition-transform duration-300 opacity-50">
                                    <i class="fas fa-bolt text-2xl text-gray-600"></i>
                                </div>
                                <div
                                    class="bg-gradient-to-br from-green-200 to-emerald-400 p-4 rounded-full shadow-md hover:scale-110 transition-transform duration-300 opacity-50">
                                    <i class="fas fa-crown text-2xl text-gray-600"></i>
                                </div>
                            </div>
                            <p class="text-center text-gray-500 text-sm mt-4" id="badges-count">Earn badges by
                                completing achievements!</p>
                        </div>
                    </div>
                </div>

                <!-- Roadmap -->
                <div class="backdrop-blur-xl bg-white/60 dark:bg-black/30 border border-white/30
                            shadow-2xl rounded-3xl p-6 sm:p-10 mb-10">

                    <div class="text-center mb-12">
                        <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-4">
                            Learning Path
                        </h2>
                        <p class="text-gray-600">
                            Follow the path below to complete your math adventure
                        </p>
                    </div>

                    <div class="roadmap-container relative">
                        <!-- Connecting Line -->
                        <div class="roadmap-line"></div>

                        <!-- LEVEL 1 -->
                        <div class="roadmap-item">
                            <button class="level-node" data-level="1" onclick="openLevel(1)">
                                <span>1</span>
                            </button>
                            <div class="roadmap-item-content">
                                <div class="level-name">Counting Friends</div>
                                <p class="level-description">
                                    Learn to count from 1 to 100 with fun activities and interactive games.
                                    Perfect for beginners!
                                </p>
                                <div class="status-badge status-active">Current Level</div>
                            </div>
                        </div>

                        <!-- LEVEL 2 -->
                        <div class="roadmap-item">
                            <button class="level-node" data-level="2" onclick="openLevel(2)">
                                <span>2</span>
                            </button>
                            <div class="roadmap-item-content">
                                <div class="level-name">Adding Magic</div>
                                <p class="level-description">
                                    Discover the magic of addition! Solve puzzles and help characters by adding numbers
                                    together.
                                </p>
                                <div class="status-badge status-locked">Locked</div>
                            </div>
                        </div>

                        <!-- LEVEL 3 -->
                        <div class="roadmap-item">
                            <button class="level-node" data-level="3" onclick="openLevel(3)">
                                <span>3</span>
                            </button>
                            <div class="roadmap-item-content">
                                <div class="level-name">Taking Away</div>
                                <p class="level-description">
                                    Master subtraction with engaging stories and real-life scenarios. Learn to take away
                                    numbers gently.
                                </p>
                                <div class="status-badge status-locked">Locked</div>
                            </div>
                        </div>

                        <!-- LEVEL 4 -->
                        <div class="roadmap-item">
                            <button class="level-node" data-level="4" onclick="openLevel(4)">
                                <span>4</span>
                            </button>
                            <div class="roadmap-item-content">
                                <div class="level-name">Sharing Fairly</div>
                                <p class="level-description">
                                    Learn division through sharing stories. Understand how to split things equally among
                                    friends.
                                </p>
                                <div class="status-badge status-locked">Locked</div>
                            </div>
                        </div>

                        <!-- LEVEL 5 -->
                        <div class="roadmap-item">
                            <button class="level-node" data-level="5" onclick="openLevel(5)">
                                <span>5</span>
                            </button>
                            <div class="roadmap-item-content">
                                <div class="level-name">Math Master Trail</div>
                                <p class="level-description">
                                    The final challenge! Combine all your skills to become a true Math Master. Are you
                                    ready?
                                </p>
                                <div class="status-badge status-locked">Locked</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div
                        class="bg-gradient-to-br from-primary to-primary-light p-6 rounded-3xl text-white shadow-medium">
                        <div class="text-2xl font-bold mb-2">Next Level Unlocks</div>
                        <p class="text-primary-100 mb-4">Complete Level 1 to unlock:</p>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center"><i class="fas fa-check-circle mr-2"></i> Adding Magic
                                Activities</li>
                            <li class="flex items-center"><i class="fas fa-trophy mr-2"></i> 5 New Achievements</li>
                            <li class="flex items-center"><i class="fas fa-star mr-2"></i> 50 Bonus Stars</li>
                        </ul>
                    </div>

                    <div class="bg-white p-6 rounded-3xl shadow-soft border border-gray-100">
                        <div class="text-2xl font-bold text-gray-800 mb-4">Today's Goal</div>
                        <div class="flex items-center mb-4">
                            <div class="flex-1 bg-gray-200 rounded-full h-3">
                                <div class="bg-primary h-3 rounded-full" style="width: 20%"></div>
                            </div>
                            <span class="ml-4 text-sm font-medium text-gray-600">20%</span>
                        </div>
                        <p class="text-gray-600 text-sm">Complete 2 more activities to reach your daily goal!</p>
                    </div>

                    <div
                        class="bg-gradient-to-br from-purple-500 to-indigo-600 p-6 rounded-3xl text-white shadow-medium">
                        <div class="text-2xl font-bold mb-2">Rewards Awaits</div>
                        <p class="text-purple-100 mb-4">Earn these by completing levels:</p>
                        <div class="flex space-x-4">
                            <div class="text-center">
                                <div class="text-2xl mb-1">‚≠ê</div>
                                <div class="text-sm">Stars</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl mb-1">üèÖ</div>
                                <div class="text-sm">Badges</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl mb-1">üé®</div>
                                <div class="text-sm">Tokens</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl mb-1">üî•</div>
                                <div class="text-sm">Streaks</div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>

        <!-- MODAL -->
        <div id="levelModal" class="level-modal">
            <div class="modal-card">
                <div class="modal-icon" id="modalIcon">üéØ</div>
                <h2 id="modalTitle" class="text-3xl font-bold text-gray-800 mb-4"></h2>
                <p id="modalDesc" class="text-gray-600 mb-6 text-lg"></p>

                <div class="mb-6 p-4 bg-gray-50 rounded-xl">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-500">Level Progress</span>
                        <span class="text-sm font-bold text-primary" id="modalProgressText">0/10 activities</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-primary h-2 rounded-full" id="modalProgressBar" style="width: 0%"></div>
                    </div>
                </div>

                <button onclick="startLevel()" class="w-full bg-gradient-to-r from-primary to-primary-light text-white 
                       px-8 py-4 rounded-full font-bold text-lg shadow-lg hover:shadow-xl 
                       transform hover:-translate-y-1 transition-all duration-300">
                    <i class="fas fa-play mr-2"></i> Start Level
                </button>

                <button onclick="closeModal()" class="w-full mt-4 text-gray-500 hover:text-gray-700 font-medium py-3">
                    Continue Exploring
                </button>
            </div>
        </div>


        <!-- Add this in roadmap.html after the main content -->
        <div class="fixed bottom-4 right-4 z-50">
            <button onclick="testProgressSystem()"
                class="bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700">
                üîß Test Progress
            </button>
        </div>

        <script>
            async function testProgressSystem() {
                console.log('üß™ Running progress system test...');

                // Test 1: Check token
                const token = localStorage.getItem('token');
                console.log('Token:', token ? '‚úì Present' : '‚úó Missing');

                // Test 2: Test save
                const testData = {
                    version: "1.0",
                    currentLevel: 1,
                    lastSync: new Date().toISOString(),
                    totals: { totalStars: 100, totalTokens: 50 }
                };

                const saveResult = await window.ArithmoProgress.saveProgress(testData);
                console.log('Save test:', saveResult.success ? '‚úì PASS' : '‚úó FAIL', saveResult);

                // Test 3: Test load
                const loadResult = await window.ArithmoProgress.getProgress();
                console.log('Load test:', loadResult ? '‚úì PASS' : '‚úó FAIL');

                // Test 4: Test activity update
                const activityResult = await window.ArithmoProgress.updateActivity(1, 1, { stars: 10 });
                console.log('Activity test:', activityResult.success ? '‚úì PASS' : '‚úó FAIL');

                alert(`Test Results:\nSave: ${saveResult.success ? '‚úÖ' : '‚ùå'}\nLoad: ${loadResult ? '‚úÖ' : '‚ùå'}\nActivity: ${activityResult.success ? '‚úÖ' : '‚ùå'}`);

                // Refresh display
                renderRoadmap();
            }
        </script>



    </div>

    <!-- Balls Background JS -->
    <script src="assets/moving-balls-bg.js"></script>
    <script src="assets/assets_common_script.js"></script>
    <script src="assets/script.js"></script>

    <script>
        /* ================== ROADMAP LOGIC ================== */

        const TOTAL_LEVELS = 5;

        /* ---------- LEVEL META ---------- */
        const levelData = {
            1: {
                title: "Counting Friends",
                desc: "Let's count together! Learn numbers 1-100 with fun games and interactive activities. Perfect for beginners! üòä",
                icon: "üë´",
                totalActivities: 10
            },
            2: {
                title: "Adding Magic",
                desc: "Discover the magic of addition! Solve puzzles and help characters by adding numbers together. ‚ú®",
                icon: "üîÆ",
                totalActivities: 10
            },
            3: {
                title: "Taking Away",
                desc: "Numbers gently say goodbye. Master subtraction with engaging stories and real-life scenarios. üëã",
                icon: "üéà",
                totalActivities: 10
            },
            4: {
                title: "Sharing Fairly",
                desc: "Learning to share equally! Understand division through fun sharing stories with friends. ü§ù",
                icon: "üçï",
                totalActivities: 10
            },
            5: {
                title: "Math Master Trail",
                desc: "The ultimate challenge! Combine all your skills to become a true Math Master. Are you ready? üéâ",
                icon: "üèÜ",
                totalActivities: 10
            }
        };

        /* ---------- LEVEL ROUTES ---------- */
        const levelRoutes = {
            1: "levels/level-1.html",
            2: "levels/level-2.html",
            3: "levels/level-3.html",
            4: "levels/level-4.html",
            5: "levels/level-5.html"
        };

        /* ---------- GET USER PROGRESS ---------- */
        async function getUserProgress() {
            try {
                if (!window.ArithmoProgress) {
                    console.log('‚è≥ Progress manager not loaded yet');
                    return null;
                }

                const progress = await window.ArithmoProgress.getProgress();
                console.log('üìä User progress:', progress);
                return progress;
            } catch (error) {
                console.error('Error getting progress:', error);
                return null;
            }
        }

        /* ---------- GET CURRENT LEVEL ---------- */
        function getCurrentLevel(progress) {
            if (!progress || !progress.levels) return 1;

            // Find the first level that's not completed
            for (let i = 1; i <= TOTAL_LEVELS; i++) {
                if (progress.levels[i] && progress.levels[i].status !== "completed") {
                    return i;
                }
            }

            // If all completed, return last level
            return TOTAL_LEVELS;
        }

        /* ---------- RENDER ROADMAP WITH REAL DATA ---------- */
        async function renderRoadmap() {
            console.log('üîÑ Rendering roadmap with real data...');

            // Get user progress
            const progress = await getUserProgress();

            // Get current level
            const currentLevel = getCurrentLevel(progress);
            console.log('üéØ Current level:', currentLevel);

            // Update ALL roadmap items
            for (let i = 1; i <= TOTAL_LEVELS; i++) {
                const levelNode = document.querySelector(`.level-node[data-level="${i}"]`);
                const statusBadge = document.querySelectorAll('.status-badge')[i - 1];

                if (!levelNode || !statusBadge) continue;

                // Reset classes
                levelNode.className = "level-node";
                statusBadge.className = "status-badge";

                // Get level progress
                const levelProgress = progress?.levels?.[i];
                const completedCount = levelProgress?.completedActivities?.length || 0;
                const totalActivities = levelData[i].totalActivities;
                const isCompleted = levelProgress?.status === "completed";

                // Update node based on status
                if (i < currentLevel || isCompleted) {
                    // Level is completed
                    levelNode.innerHTML = '<i class="fas fa-check"></i>';
                    levelNode.classList.add("completed");
                    statusBadge.classList.add("status-completed");
                    statusBadge.textContent = "Completed";
                } else if (i === currentLevel) {
                    // Current active level
                    levelNode.innerHTML = `<span>${i}</span>`;
                    levelNode.classList.add("active");
                    statusBadge.classList.add("status-active");
                    statusBadge.textContent = "Current Level";
                } else {
                    // Future locked level
                    levelNode.innerHTML = `<span>${i}</span>`;
                    levelNode.classList.add("locked");
                    statusBadge.classList.add("status-locked");
                    statusBadge.textContent = "Locked";
                }

                // Add progress info to each roadmap item
                const itemContent = levelNode.closest('.roadmap-item').querySelector('.roadmap-item-content');
                if (itemContent) {
                    // Remove existing progress info
                    const existingProgress = itemContent.querySelector('.level-progress-info');
                    if (existingProgress) {
                        existingProgress.remove();
                    }

                    // Add new progress info
                    const percent = Math.round((completedCount / totalActivities) * 100);
                    const progressHTML = `
                <div class="level-progress-info mt-3">
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-xs text-gray-500">Progress</span>
                        <span class="text-xs font-bold text-primary">${completedCount}/${totalActivities} activities</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                        <div class="bg-primary h-1.5 rounded-full" style="width: ${percent}%"></div>
                    </div>
                </div>
            `;

                    const description = itemContent.querySelector('.level-description');
                    if (description) {
                        description.insertAdjacentHTML('afterend', progressHTML);
                    }
                }
            }

            // Update overall stats
            updateOverallStats(progress);
        }

        /* ---------- UPDATE OVERALL STATS ---------- */
        function updateOverallStats(progress) {
            if (!progress) {
                console.log('No progress data for stats');
                return;
            }

            const totals = progress.totals || {};
            const levels = progress.levels || {};

            // Calculate completed levels
            const completedLevels = Object.values(levels).filter(l => l.status === "completed").length;

            // Calculate total activities completed
            const totalActivities = Object.values(levels).reduce((sum, level) => {
                return sum + (level.completedActivities?.length || 0);
            }, 0);

            // Update stats display
            document.getElementById('levels-completed').textContent = `${completedLevels}/${TOTAL_LEVELS}`;
            document.getElementById('total-activities').textContent = `${totalActivities}/${TOTAL_LEVELS * 10}`;
            document.getElementById('total-stars').textContent = totals.totalStars || '0';
            document.getElementById('total-tokens').textContent = totals.totalTokens || '0';

            // Update badges
            updateBadgesDisplay(totals.totalBadges || 0);
        }

        /* ---------- UPDATE BADGES DISPLAY ---------- */
        function updateBadgesDisplay(badgesCount) {
            const badgesContainer = document.getElementById('badges-container');
            const badgesCountElement = document.getElementById('badges-count');

            if (!badgesContainer || !badgesCountElement) return;

            if (badgesCount > 0) {
                badgesContainer.querySelectorAll('.opacity-50').forEach(badge => {
                    badge.classList.remove('opacity-50');
                    badge.classList.add('opacity-100', 'badge-earned');
                });

                badgesCountElement.textContent = `You've earned ${badgesCount} badges!`;
            } else {
                badgesCountElement.textContent = 'Complete levels to earn badges!';
            }
        }

        /* ---------- OPEN LEVEL MODAL ---------- */
        async function openLevel(level) {
            // Get current progress
            const progress = await getUserProgress();
            const currentLevel = getCurrentLevel(progress);

            // Only allow opening current level
            if (level !== currentLevel) {
                console.log(`Level ${level} is not the current level (${currentLevel})`);
                return;
            }

            const data = levelData[level];
            document.getElementById("modalTitle").innerText = data.title;
            document.getElementById("modalDesc").innerText = data.desc;
            document.getElementById("modalIcon").textContent = data.icon;

            // Update modal with actual progress data
            await updateModalProgress(level, progress);

            document.getElementById("levelModal").classList.add("active");
        }

        /* ---------- UPDATE MODAL PROGRESS ---------- */
        async function updateModalProgress(level, progress) {
            try {
                const modalProgressText = document.getElementById('modalProgressText');
                const modalProgressBar = document.getElementById('modalProgressBar');

                if (progress && progress.levels && progress.levels[level]) {
                    const levelProgress = progress.levels[level];
                    const completed = levelProgress.completedActivities ? levelProgress.completedActivities.length : 0;
                    const total = levelData[level].totalActivities;
                    const percent = Math.round((completed / total) * 100);

                    modalProgressText.textContent = `${completed}/${total} activities`;
                    modalProgressBar.style.width = `${percent}%`;
                } else {
                    // Fallback to default
                    modalProgressText.textContent = `0/${levelData[level].totalActivities} activities`;
                    modalProgressBar.style.width = "0%";
                }
            } catch (error) {
                console.error('Error updating modal progress:', error);
                const total = levelData[level]?.totalActivities || 10;
                document.getElementById('modalProgressText').textContent = `0/${total} activities`;
                document.getElementById('modalProgressBar').style.width = "0%";
            }
        }

        /* ---------- CLOSE MODAL ---------- */
        function closeModal() {
            document.getElementById("levelModal").classList.remove("active");
        }

        /* ---------- START LEVEL ---------- */
        async function startLevel() {
            // Get current level
            const progress = await getUserProgress();
            const currentLevel = getCurrentLevel(progress);

            const route = levelRoutes[currentLevel];
            if (!route) {
                console.error('No route found for level', currentLevel);
                return;
            }

            console.log('üöÄ Starting level', currentLevel);
            window.location.href = route;
        }

        /* ---------- INITIALIZE ---------- */
        document.addEventListener("DOMContentLoaded", async function () {
            console.log('üéÆ Roadmap page loaded');

            // Wait a bit for progress manager to load
            setTimeout(async () => {
                await renderRoadmap();

                // Add click animations
                document.querySelectorAll('.level-node').forEach(node => {
                    node.addEventListener('click', async function (e) {
                        const level = Number(this.dataset.level);

                        if (this.classList.contains('locked')) {
                            e.preventDefault();
                            this.style.transform = 'scale(0.95)';
                            setTimeout(() => {
                                this.style.transform = '';
                            }, 200);
                        } else {
                            // Open modal with updated progress
                            await openLevel(level);
                        }
                    });
                });
            }, 500);

            // Refresh roadmap every 5 seconds (in case progress updates)
            setInterval(renderRoadmap, 5000);
        });

    </script>

    <script src="assets/check-navbar.js"></script>

    <!-- Progress Manager -->
    <script src="assets/progress-manager.js"></script>

</body>

</html>